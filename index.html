<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>REVINGO ー Reversi × Bingo ー</title>
  <style>
    :root{color-scheme:dark;}
    html,body{height:100%;margin:0;background:#0b0f14;color:#e7eef7;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}

    /* Layout: keep header slim and ensure canvas area is always tappable (including bottom row) */
    #wrap{height:100%;display:flex;flex-direction:column;min-height:0;}

    header{flex:0 0 auto;display:flex;flex-wrap:wrap;gap:6px;align-items:center;
      padding:6px 8px calc(6px + env(safe-area-inset-top));
      border-bottom:1px solid #1b2633;background:#0c121a;
    }

    .pill{padding:6px 10px;border:1px solid #223244;border-radius:999px;background:#0f1822;line-height:1.2;}
    .mini{padding:5px 9px;font-size:13px;}
    .title{font-weight:700;letter-spacing:.2px;}

    header select, header button{
      background:#0f1822;color:#e7eef7;border:1px solid #223244;border-radius:12px;
      padding:8px 10px;cursor:pointer;font-size:13px;
    }
    header button:hover{filter:brightness(1.07)}
    header button:active{transform:translateY(1px)}
    header button:disabled{opacity:.55;cursor:not-allowed}

    /* HUD grid: compact on mobile */
    #hud{display:grid;gap:6px;grid-template-columns:repeat(2,minmax(0,1fr));flex:1 1 320px;min-width:240px;}
    #hud .pill{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    .controls{display:flex;gap:6px;flex-wrap:wrap;align-items:center;}
    .controls .pill{display:flex;gap:8px;align-items:center;}

    /* Main canvas region */
    #main{flex:1 1 auto;min-height:0;display:flex;flex-direction:column;}
    #canvasWrap{flex:1 1 auto;min-height:0;position:relative;}
    #canvas{display:block;width:100%;height:100%;touch-action:none;}

    /* Bottom bar (rule button) – does NOT overlay the board area */
    #bottomBar{flex:0 0 auto;padding:8px 10px calc(10px + env(safe-area-inset-bottom));
      background:linear-gradient(to top, rgba(12,18,26,0.92), rgba(12,18,26,0.72));
      border-top:1px solid #1b2633;
      display:flex;justify-content:center;align-items:center;
    }
    #rulesBtn{min-width:min(520px,92vw);}

    /* Toast */
    #toast{position:fixed;left:50%;transform:translateX(-50%);
      bottom:calc(64px + env(safe-area-inset-bottom));
      background:rgba(14,22,32,0.92);border:1px solid rgba(120,160,210,0.25);
      padding:10px 14px;border-radius:999px;backdrop-filter:blur(6px);
      box-shadow:0 10px 30px rgba(0,0,0,0.35);
      opacity:0;pointer-events:none;transition:opacity .18s ease;
      max-width:min(640px,92vw);text-align:center;
    }
    #toast.show{opacity:1;}

    /* Overlay modal */
    #overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.55);backdrop-filter:blur(2px);padding:18px;
    }
    #overlay .card{background:#0c121a;border:1px solid #223244;border-radius:18px;
      padding:18px 16px;min-width:280px;max-width:min(520px,92vw);
      box-shadow:0 12px 30px rgba(0,0,0,0.45)
    }
    #overlay h2{margin:0 0 8px 0;font-size:18px}
    #overlay p{margin:6px 0;color:#b9c7d8;line-height:1.5}
    #overlay .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    #overlay button{flex:1}

    /* Rules drawer */
    #rules{position:fixed;left:0;right:0;bottom:0;transform:translateY(105%);
      transition:transform .22s ease;z-index:20;
      background:rgba(12,18,26,0.96);border-top:1px solid #223244;backdrop-filter:blur(8px);
      padding:14px 14px calc(14px + env(safe-area-inset-bottom));
      max-height:min(52vh,520px);overflow:auto;
    }
    #rules.show{transform:translateY(0%);}
    #rules .head{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:8px;}
    #rules .warn{color:#ffd27a}
    kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#101a24;border:1px solid #243447;border-bottom-width:2px;border-radius:6px;padding:1px 6px;color:#d7e6ff}

    @media (max-width: 420px){
      header{padding:6px 8px calc(6px + env(safe-area-inset-top));}
      .pill{padding:5px 8px;font-size:12px;}
      header select, header button{padding:7px 9px;font-size:12px}
    }
  </style>
</head>
<body>
<div id="wrap">
  <header>
    <span class="pill mini title" id="titlePill">REVINGO</span>

    <div id="hud">
      <span class="pill mini" id="turnPill">手番: -</span>
      <span class="pill mini" id="scorePill">得点 黒:0 / 白:0</span>
      <span class="pill mini" id="diffPill">スコア差(自分-敵): 0</span>
      <span class="pill mini" id="itemPill">⚡ 黒:1 / 白:1</span>
    </div>

    <div class="controls">
      <label class="pill mini" style="gap:8px;">
        対戦
        <select id="modeSel">
          <option value="cpu">人 vs CPU（白）</option>
          <option value="pvp">人 vs 人</option>
        </select>
      </label>

      <label class="pill mini" style="gap:8px;">
        難易度
        <select id="diffSel">
          <option value="normal">NORMAL</option>
          <option value="hard">HARD</option>
        </select>
      </label>

      <label class="pill mini" style="gap:8px;">
        テーマ
        <select id="themeSel">
          <option value="neon">ネオン</option>
          <option value="classic">クラシック</option>
        </select>
      </label>

      <button id="lightningBtn" class="mini" title="稲妻：双方合法手なしのときだけ使用可">⚡ 稲妻</button>
      <button id="resetBtn" class="mini">リセット</button>
    </div>
  </header>

  <div id="main">
    <div id="canvasWrap">
      <canvas id="canvas"></canvas>
    </div>

    <div id="bottomBar">
      <button id="rulesBtn" class="pill">ルールを見る</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<div id="overlay">
  <div class="card">
    <h2 id="ovTitle">通知</h2>
    <p id="ovBody"></p>
    <div class="row" id="ovRow">
      <button id="ovPrimary">OK</button>
      <button id="ovSecondary" style="display:none">キャンセル</button>
    </div>
  </div>
</div>

<div id="rules">
  <div class="head">
    <div class="pill" style="border-radius:12px;">ルール</div>
    <button id="rulesClose">閉じる</button>
  </div>
  <div><span class="warn">REVINGO</span>：<b>Reversi × Bingo</b>（オセロの挟み＋ビンゴのライン成立）。盤面は <b>8×8固定</b>。</div>
  <div style="margin-top:6px;"><span class="warn">BINGO</span>：<b>横/縦/斜め(2本)</b>が<b>完全に同色</b>で揃うと、そのラインの石を消去（得点＝消した石数）。</div>
  <div style="margin-top:6px;"><span class="warn">リーチ</span>：あなた（黒）の石が<b>あと1マスでBINGO</b>になるラインは、盤面上で光って表示されます。</div>
  <div style="margin-top:6px;"><span class="warn">パスルール</span>：盤上に<b>空きマスがある</b>のに手番が指せる手が無い場合は <b>相手のターン</b>（自動パス）。</div>
  <div style="margin-top:6px;"><span class="warn">終局</span>：双方とも指せる手が無い（=両者の合法手が0）状態になったら<b>ゲームオーバー</b>。ただしその瞬間に⚡が残っていれば<b>稲妻で続行</b>できます。</div>
  <div style="margin-top:6px;"><span class="warn">稲妻</span>：敵の駒をランダムに<b>5個</b>破壊 → 破壊した<b>5箇所すべて</b>に<b>自駒を5個</b>再配置（<b>手番は消費しない / 自駒破壊コストなし</b> / 初期所持：黒1・白1）。</div>
  <div style="margin-top:6px;">操作：タップ＝着手 / <kbd>⚡稲妻</kbd>＝アイテム発動 / <kbd>リセット</kbd>＝初期化</div>
</div>

<script type="module" src="./src/app.js"></script>
</body>
</html>
